!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function Editor(e){this.editor=e,this.delay=DELAY,this.onChange=function(){},this._oldSource=null,this._timer=null,this.setListeners()}module.exports=Editor;const DELAY=800;Editor.prototype.setListeners=function(){var e=this,t=e.editor;t.on("cursorActivity",e.scheduleBuild.bind(e)),t.on("focus",e.scheduleBuild.bind(e)),t.on("keydown",e.scheduleBuild.bind(e)),t.on("keypress",e.scheduleBuild.bind(e)),t.on("keyup",e.scheduleBuild.bind(e)),t.on("mousedown",e.scheduleBuild.bind(e)),t.on("mouseup",e.scheduleBuild.bind(e))},Editor.prototype.scheduleBuild=function(){var e=this,t=e.editor,i=t.getValue()===e._oldSource;i||(null!==e._timer&&(clearTimeout(e._timer),e._timer=null),e._timer=setTimeout(function(){e.build(),e._timer=null},e.delay))},Editor.prototype.build=function(e){var t=this,i=t.editor,o=i.getValue();t._oldSource=o,t.onChange(o,e)},Editor.prototype.setValue=function(e){this.editor.setValue(e),this.scheduleBuild()},Editor.prototype.deactivate=function(){var e=this.editor;e.setOption("readOnly","nocursor")},Editor.prototype.reactivate=function(){var e=this.editor;e.setOption("readOnly",!1)},Editor.prototype.highlight=function(e){var t=this.editor,i=e.location,o="marker mark-"+e.event.replace(":","-");return t.markText({line:i.start.line-1,ch:i.start.column-1},{line:i.end.line-1,ch:i.end.column-1},{className:o})||{clear:function(){}}}},{}],2:[function(require,module,exports){function updateQueryString(t,e,i){i||(i=window.location.href);var r,n=new RegExp("([?&])"+t+"=.*?(&|#|$)(.*)","gi");if(n.test(i))return"undefined"!=typeof e&&null!==e?i.replace(n,"$1"+t+"="+e+"$2$3"):(r=i.split("#"),i=r[0].replace(n,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof r[1]&&null!==r[1]&&(i+="#"+r[1]),i);if("undefined"!=typeof e&&null!==e){var o=-1!==i.indexOf("?")?"&":"?";return r=i.split("#"),i=r[0]+o+t+"="+e,"undefined"!=typeof r[1]&&null!==r[1]&&(i+="#"+r[1]),i}return i}function getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(window.location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function getTime(){var t=new Date;return("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)}var Editor=require("./editor"),Parser=require("./parser"),Solver=require("./solver"),util=require("./util");$(document).ready(function(){function t(t){return g.store.empty(),0===t.length?(g.store.append("<tr><td></td><td>(empty)</td></tr>"),void $("#clearStore").hide()):(t.forEach(function(t){var r='<tr data-constraint-id="'+t.id+'"><td>'+t.id+"</td><td><code>"+t.string+"</code>";r+='<button type="button" title="Remove" class="close remove-constraint" data-constraint-id="'+t.id+'">Ã—</button>',r+="</td></tr>",g.store.append(r),g.store.find("button.remove-constraint").on("click",i),g.store.find("button.reactivate-constraint").on("click",e)}),void g.clearStore.show())}function e(){}function i(t){var e;e="string"==typeof t?t:$(this).data("constraintId"),p.killConstraint(e),g.store.find('tr[data-constraint-id="'+e+'"]').remove(),0===g.store.find("tr").length&&(g.store.append("<tr><td></td><td>(empty)</td></tr>"),$("#clearStore").hide())}function r(){g.store.find("tr").each(function(t){$(this).attr("data-constraint-id")&&i($(this).attr("data-constraint-id"))})}function n(){var t=getParameterByName("gist");if(t){g.spinner.show();var e=new Gister({isAnonymous:!0});e.on("error",function(t){g.spinner.hide(),g.gistErrorNotification.find(".mesg").text(t.toString())}),e.on("gist",function(t){return g.spinner.hide(),t.files&&t.files["chrjs.chr"]?void y.setValue(t.files["chrjs.chr"].content):void g.gistErrorNotification.find(".mesg").text("Given Gist has no CHR code.")}),e.get(t)}}function o(){g.compileButton.hide(),f=$("#tracer-speed").slider({formatter:function(t){return"Pause per step: "+t+"s"}}),g.sliderTraceSpeed=$("#tracer-adjust-speed"),$('[data-type="switch"]').bootstrapSwitch(),g.switchAutocompilation.on("switchChange.bootstrapSwitch",function(t,e){e?(g.compileButton.fadeOut(),y.build({forced:!0})):(g.compileButton.fadeIn(),g.parsingErrorNotification.fadeOut())}),g.switchTracing.on("switchChange.bootstrapSwitch",function(t,e){e?(p.activateTrace(),g.traceLog.slideDown()):(g.traceLog.slideUp(),p.deactivateTrace())}),g.switchTraceAutoplay.on("switchChange.bootstrapSwitch",function(t,e){e?(g.tracerContinue.hide(),g.sliderTraceSpeed.show()):(g.sliderTraceSpeed.hide(),g.tracerContinue.show())}),g.gistSave.click(function(){c({"public":!0})}),g.tracerContinueButton.click(function(){g.tracerContinueButton.hide(),g.spinner.show(),h&&h.clear&&h.clear(),p.continueBreakpoint()})}function c(t){t=t||{};var e=new Gister({isAnonymous:!0});e.on("created",function(t){g.spinner.hide();var e=updateQueryString("gist",t.id);window.history.replaceState({},"Gist: "+t.id,e)}),e.on("error",function(t){g.spinner.hide(),g.gistErrorNotification.find(".mesg").text(t.toString())}),e.create({"chrjs.chr":w.getValue()})}function a(e){if(h=y.highlight(e),g.spinner.hide(),e&&e.store&&t(e.store),s(e),g.switchTraceAutoplay.bootstrapSwitch("state")){var i=1e3*f.slider("getValue");setTimeout(function(){h.clear(),g.spinner.show(),p.continueBreakpoint()},i)}else g.tracerContinueButton.show()}function s(t){var e="";"rule:try"===t.event?e='Try rule "'+t.rule+'" for '+t.constraint:"rule:try-occurence"===t.event&&(e="Try occurence "+t.occurence+" for "+t.constraint);var i="<p><code>["+getTime()+"] "+e+"</code></p>";g.traceLogPanel.append(i),g.traceLogPanel.animate({scrollTop:g.traceLogPanel.prop("scrollHeight")},600)}function u(){y.deactivate(),g.compileButton.prop("disabled","disabled"),g.switchAutocompilation.bootstrapSwitch("disabled",!0),g.switchPersistentStore.bootstrapSwitch("disabled",!0)}function d(){y.reactivate(),g.compileButton.prop("disabled",!1),g.switchAutocompilation.bootstrapSwitch("disabled",!1),g.switchPersistentStore.bootstrapSwitch("disabled",!1)}var l,p,f,h,g={notifications:$("#notifications > *"),spinner:$("#spinner"),parsingErrorNotification:$("#notification-parsing-error"),queryErrorNotification:$("#notification-query-error"),gistErrorNotification:$("#notification-gist-error"),queryButton:$("#query button"),queryInput:$("#query input"),compileButton:$("#compile-button"),store:$("#store tbody"),clearStore:$("#clearStore"),switchAutocompilation:$('input[name="cb-live-compilation"]'),switchPersistentStore:$('input[name="cb-persistent-store"]'),switchTracing:$('input[name="cb-tracing"]'),switchTraceAutoplay:$('input[name="cb-trace-autoplay"]'),sliderTraceSpeed:null,gistSave:$("#gist-save"),traceLog:$("#trace-log"),traceLogPanel:$("#trace-log .panel-body"),tracerContinue:$("#tracer-continue"),tracerContinueButton:$("#tracer-continue-button")};o(),l=new Parser,l.onStart=function(){g.spinner.show(),util.hide(g.notifications)},l.onError=function(t,e){g.spinner.hide(),util.hide(g.notifications),"source"===t&&($("#notification-parsing-error .type").text("source code"),$("#notification-parsing-error .mesg").text(e),util.show(g.parsingErrorNotification)),"query"===t&&($("#notification-parsing-error .type").text("query"),$("#notification-parsing-error .mesg").text(e),util.show(g.parsingErrorNotification))},l.onEnd=function(t,e,i){return g.spinner.hide(),util.hide(g.notifications),"source"===t?(p.setSource(e),void(g.switchTracing.bootstrapSwitch("state")&&p.activateTrace)):"query"===t?i&&i.trace?void p.callQuery(e,{trace:!0}):void p.callQuery(e):void 0},p=new Solver({queryInput:g.queryInput}),p.onStart=function(){g.spinner.show(),util.hide(g.notifications),g.queryButton.prop("disabled","disabled"),u()},p.onError=function(t){$("#notification-query-error .mesg").text(t),g.queryErrorNotification.show()},p.onEnd=function(e){g.queryInput.val(""),g.spinner.hide(),g.queryButton.prop("disabled",!1),d(),e&&e.store&&t(e.store)},p.onBreakpoint=function(t){a(t)},p.getOptions=function(){return{persistentStore:g.switchPersistentStore.bootstrapSwitch("state")}};var w=CodeMirror.fromTextArea($("#source").get(0),{lineNumbers:!0,theme:"monokai",styleActiveLine:!0,matchBrackets:!0});$(".CodeMirror, #source-control").click(function(){return!1}),$("#source-col").click(function(){w.setCursor(w.lineCount(),0),w.focus()});var y=new Editor(w);y.onChange=function(t,e){e=e||{},e.forced=e.forced||!1,(g.switchAutocompilation.bootstrapSwitch("state")||e.forced)&&l.parse("source",t)},g.compileButton.click(function(){y.build({forced:!0})}),g.queryButton.click(function(){var t=g.queryInput.val();g.switchTracing.bootstrapSwitch("state")?(g.traceLogPanel.empty(),l.parse("query",t,{trace:!0})):l.parse("query",t)}),g.queryInput.keypress(function(t){13===t.which&&g.queryButton.click()}),$("#notifications > div button.close").click(function(t){$(this).parent().fadeOut()}),$("#clearStore").click(function(t){r()}),w.focus(),n()})},{"./editor":1,"./parser":3,"./solver":4,"./util":5}],3:[function(require,module,exports){function Parser(r,t){this.onStart=function(){},this.onEnd=function(){},this.onError=function(){},this.worker=new Worker(PARSERWORKER_URI),this._setEventListener()}module.exports=Parser;const BASE_URI=URI,PARSERWORKER_URI=BASE_URI+"/public/js/playground/parserworker.js";Parser.prototype.parse=function(r,t,e){e=e||{},this.onStart(),this.worker.postMessage({type:r,source:t,data:e})},Parser.prototype._setEventListener=function(){var r=this,t=this.worker;t.addEventListener("message",function(t){var e=t.data;return e.error?void r.onError(e.type,e.error):void r.onEnd(e.type,e.parsed,e.data)})}},{}],4:[function(require,module,exports){function Solver(t){function n(t){e.info=t,e.setupQueryInput()}function o(t){return t&&t.hasOwnProperty("error")?void e.onError(t.error):void e.onEnd(t)}function r(t){e.onBreakpoint(t)}var e=this;this.onStart=function(){},this.onError=function(){},this.onEnd=function(){},this.onBreakpoint=function(){},this.getOptions=function(){return{}},t=t||{},t.queryInput=t.queryInput||null;var i=new jailed.Plugin(CHRWORKER_URI,{setInfo:n,queryFinished:o,breakpoint:r});i.whenConnected(function(){i.remote.loadCHR(CHR_URI)}),this.plugin=i,this.queryInput=t.queryInput}module.exports=Solver;const BASE_URI=URI,CHRWORKER_URI=BASE_URI+"/public/js/playground/chrworker.js",CHR_URI=BASE_URI+"/public/js/playground/chr-wop.js";Solver.prototype.setSource=function(t){var n=this.getOptions()||{};this.plugin.remote.setSource(t,n)},Solver.prototype.callQuery=function(t,n){this.onStart(),this.plugin.remote.callQuery(t)},Solver.prototype.killConstraint=function(t){this.plugin.remote.killConstraint(t)},Solver.prototype.activateTrace=function(){this.plugin.remote.activateTrace()},Solver.prototype.deactivateTrace=function(){this.plugin.remote.deactivateTrace()},Solver.prototype.continueBreakpoint=function(){this.plugin.remote.continueBreakpoint()},Solver.prototype.setupQueryInput=function(){var t=this;this.queryInput&&this.queryInput.textcomplete([{context:function(t){for(var n=0,o=0;o<t.length;o++)if("("===t[o]?n++:")"===t[o]&&n--,0>n)return!1;return 0===n},match:/(^|[\s,])([a-z][A-z0-9_]*)?$/,index:2,search:function(n,o){for(var r=[],e=0;e<t.info.functors.length;e++)0===t.info.functors[e].indexOf(n)&&r.push(t.info.functors[e]);o(r)},replace:function(t){var n=t.split("/")[0],o=parseInt(t.split("/")[1],10);return o>0?["$1"+n+"(",Array(o).join(",")+")"]:"$1"+n}}])}},{}],5:[function(require,module,exports){function show(e){e.removeClass("inactive")}function hide(e){e.addClass("inactive")}module.exports={},module.exports.show=show,module.exports.hide=hide},{}]},{},[2]);
