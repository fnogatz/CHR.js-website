!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function Editor(e){this.editor=e,this.delay=DELAY,this.onChange=function(){},this._oldSource=null,this._timer=null,this.setListeners()}module.exports=Editor;const DELAY=800;Editor.prototype.setListeners=function(){var e=this,i=e.editor;i.on("cursorActivity",e.scheduleBuild.bind(e)),i.on("focus",e.scheduleBuild.bind(e)),i.on("keydown",e.scheduleBuild.bind(e)),i.on("keypress",e.scheduleBuild.bind(e)),i.on("keyup",e.scheduleBuild.bind(e)),i.on("mousedown",e.scheduleBuild.bind(e)),i.on("mouseup",e.scheduleBuild.bind(e))},Editor.prototype.scheduleBuild=function(){var e=this,i=e.editor,t=i.getValue()===e._oldSource;t||(null!==e._timer&&(clearTimeout(e._timer),e._timer=null),e._timer=setTimeout(function(){e.build(),e._timer=null},e.delay))},Editor.prototype.build=function(e){var i=this,t=i.editor,o=t.getValue();i._oldSource=o,i.onChange(o,e)},Editor.prototype.setValue=function(e){this.editor.setValue(e),this.scheduleBuild()}},{}],2:[function(require,module,exports){function updateQueryString(t,i,e){e||(e=window.location.href);var r,n=new RegExp("([?&])"+t+"=.*?(&|#|$)(.*)","gi");if(n.test(e))return"undefined"!=typeof i&&null!==i?e.replace(n,"$1"+t+"="+i+"$2$3"):(r=e.split("#"),e=r[0].replace(n,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof r[1]&&null!==r[1]&&(e+="#"+r[1]),e);if("undefined"!=typeof i&&null!==i){var o=-1!==e.indexOf("?")?"&":"?";return r=e.split("#"),e=r[0]+o+t+"="+i,"undefined"!=typeof r[1]&&null!==r[1]&&(e+="#"+r[1]),e}return e}function getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=i.exec(window.location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}var Editor=require("./editor"),Parser=require("./parser"),Solver=require("./solver"),util=require("./util");$(document).ready(function(){function t(t){return u.store.empty(),0===t.length?(u.store.append("<tr><td></td><td>(empty)</td></tr>"),void $("#clearStore").hide()):(t.forEach(function(t){var r='<tr data-constraint-id="'+t.id+'"><td>'+t.id+"</td><td><code>"+t.string+"</code>";r+='<button type="button" title="Remove" class="close remove-constraint" data-constraint-id="'+t.id+'">Ã—</button>',r+="</td></tr>",u.store.append(r),u.store.find("button.remove-constraint").on("click",e),u.store.find("button.reactivate-constraint").on("click",i)}),void u.clearStore.show())}function i(){}function e(t){var i;i="string"==typeof t?t:$(this).data("constraintId"),a.killConstraint(i),u.store.find('tr[data-constraint-id="'+i+'"]').remove(),0===u.store.find("tr").length&&(u.store.append("<tr><td></td><td>(empty)</td></tr>"),$("#clearStore").hide())}function r(){u.store.find("tr").each(function(t){$(this).attr("data-constraint-id")&&e($(this).attr("data-constraint-id"))})}function n(){var t=getParameterByName("gist");if(t){u.spinner.show();var i=new Gister({isAnonymous:!0});i.on("error",function(t){u.spinner.hide(),u.gistErrorNotification.find(".mesg").text(t.toString())}),i.on("gist",function(t){return u.spinner.hide(),t.files&&t.files["chrjs.chr"]?void f.setValue(t.files["chrjs.chr"].content):void u.gistErrorNotification.find(".mesg").text("Given Gist has no CHR code.")}),i.get(t)}}function o(){u.compileButton.hide(),$('[data-type="switch"]').bootstrapSwitch(),u.switchAutocompilation.on("switchChange.bootstrapSwitch",function(t,i){i?(u.compileButton.fadeOut(),f.build({forced:!0})):(u.compileButton.fadeIn(),u.parsingErrorNotification.fadeOut())}),u.gistSave.click(function(){c({"public":!0})})}function c(t){t=t||{};var i=new Gister({isAnonymous:!0});i.on("created",function(t){u.spinner.hide();var i=updateQueryString("gist",t.id);window.history.replaceState({},"Gist: "+t.id,i)}),i.on("error",function(t){u.spinner.hide(),u.gistErrorNotification.find(".mesg").text(t.toString())}),i.create({"chrjs.chr":d.getValue()})}var s,a,u={notifications:$("#notifications > *"),spinner:$("#spinner"),parsingErrorNotification:$("#notification-parsing-error"),queryErrorNotification:$("#notification-query-error"),gistErrorNotification:$("#notification-gist-error"),queryButton:$("#query button"),queryInput:$("#query input"),compileButton:$("#compile-button"),store:$("#store tbody"),clearStore:$("#clearStore"),switchAutocompilation:$('input[name="cb-live-compilation"]'),switchPersistentStore:$('input[name="cb-persistent-store"]'),gistSave:$("#gist-save")};o(),s=new Parser,s.onStart=function(){u.spinner.show(),util.hide(u.notifications)},s.onError=function(t,i){u.spinner.hide(),util.hide(u.notifications),"source"===t&&($("#notification-parsing-error .type").text("source code"),$("#notification-parsing-error .mesg").text(i),util.show(u.parsingErrorNotification)),"query"===t&&($("#notification-parsing-error .type").text("query"),$("#notification-parsing-error .mesg").text(i),util.show(u.parsingErrorNotification))},s.onEnd=function(t,i){return u.spinner.hide(),util.hide(u.notifications),"source"===t?void a.setSource(i):"query"===t?void a.callQuery(i):void 0},a=new Solver({queryInput:u.queryInput}),a.onStart=function(){u.spinner.show(),util.hide(u.notifications)},a.onError=function(t){$("#notification-query-error .mesg").text(t),u.queryErrorNotification.show()},a.onEnd=function(i){u.queryInput.val(""),u.spinner.hide(),i&&i.store&&t(i.store)},a.getOptions=function(){return{persistentStore:u.switchPersistentStore.bootstrapSwitch("state")}};var d=CodeMirror.fromTextArea($("#source").get(0),{lineNumbers:!0,theme:"monokai",styleActiveLine:!0,matchBrackets:!0});$(".CodeMirror, #source-control").click(function(){return!1}),$("#source-col").click(function(){d.setCursor(d.lineCount(),0),d.focus()});var f=new Editor(d);f.onChange=function(t,i){i=i||{},i.forced=i.forced||!1,(u.switchAutocompilation.bootstrapSwitch("state")||i.forced)&&s.parse("source",t)},u.compileButton.click(function(){f.build({forced:!0})}),u.queryButton.click(function(){var t=u.queryInput.val();s.parse("query",t)}),u.queryInput.keypress(function(t){13===t.which&&u.queryButton.click()}),$("#notifications > div button.close").click(function(t){$(this).parent().fadeOut()}),$("#clearStore").click(function(t){r()}),d.focus(),n()})},{"./editor":1,"./parser":3,"./solver":4,"./util":5}],3:[function(require,module,exports){function Parser(r,t){this.onStart=function(){},this.onEnd=function(){},this.onError=function(){},this.worker=new Worker(PARSERWORKER_URI),this._setEventListener()}module.exports=Parser;const BASE_URI=URI,PARSERWORKER_URI=BASE_URI+"/public/js/playground/parserworker.js";Parser.prototype.parse=function(r,t){this.onStart(),this.worker.postMessage({type:r,source:t})},Parser.prototype._setEventListener=function(){var r=this,t=this.worker;t.addEventListener("message",function(t){var e=t.data;return e.error?void r.onError(e.type,e.error):void r.onEnd(e.type,e.parsed)})}},{}],4:[function(require,module,exports){function Solver(t){function n(t){o.info=t,o.setupQueryInput()}function r(t){return t&&t.hasOwnProperty("error")?void o.onError(t.error):void o.onEnd(t)}var o=this;this.onStart=function(){},this.onError=function(){},this.onEnd=function(){},this.getOptions=function(){return{}},t=t||{},t.queryInput=t.queryInput||null;var e=new jailed.Plugin(CHRWORKER_URI,{setInfo:n,queryFinished:r});e.whenConnected(function(){e.remote.loadCHR(CHR_URI)}),this.plugin=e,this.queryInput=t.queryInput}module.exports=Solver;const BASE_URI=URI,CHRWORKER_URI=BASE_URI+"/public/js/playground/chrworker.js",CHR_URI=BASE_URI+"/public/js/playground/chr-wop.js";Solver.prototype.setSource=function(t){var n=this.getOptions()||{};this.plugin.remote.setSource(t,n)},Solver.prototype.callQuery=function(t){this.onStart(),this.plugin.remote.callQuery(t)},Solver.prototype.killConstraint=function(t){this.plugin.remote.killConstraint(t)},Solver.prototype.setupQueryInput=function(){var t=this;this.queryInput&&this.queryInput.textcomplete([{context:function(t){for(var n=0,r=0;r<t.length;r++)if("("===t[r]?n++:")"===t[r]&&n--,0>n)return!1;return 0===n},match:/(^|[\s,])([a-z][A-z0-9_]*)?$/,index:2,search:function(n,r){for(var o=[],e=0;e<t.info.functors.length;e++)0===t.info.functors[e].indexOf(n)&&o.push(t.info.functors[e]);r(o)},replace:function(t){var n=t.split("/")[0],r=parseInt(t.split("/")[1],10);return r>0?["$1"+n+"(",Array(r).join(",")+")"]:"$1"+n}}])}},{}],5:[function(require,module,exports){function show(e){e.removeClass("inactive")}function hide(e){e.addClass("inactive")}module.exports={},module.exports.show=show,module.exports.hide=hide},{}]},{},[2]);
